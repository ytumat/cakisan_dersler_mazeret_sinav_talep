<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ã‡akÄ±ÅŸan Dersler Ä°Ã§in Mazeret DilekÃ§esi</title>
  <style>
    body {
      font-family: Calibri, "Times New Roman", serif;
      background-color: #f4f4f4;
      padding: 20px;
    }
    .container {
      max-width: 900px;
      margin: auto;
      background: white;
      padding: 30px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    input, select, textarea {
      width: 100%;
      padding: 8px;
      margin-top: 6px;
      margin-bottom: 16px;
      font-size: 16px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      margin-top: 10px;
      margin-right: 10px;
      cursor: pointer;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 30px;
    }
    table, th, td {
      border: 1px solid black;
      padding: 10px;
      text-align: center;
    }
    .letter-section {
      display: none;
      background: white;
      border: none;
      width: 794px;           /* A4 geniÅŸliÄŸi (96 DPI'ya gÃ¶re) */
      min-height: 1123px;     /* A4 yÃ¼ksekliÄŸi */
      margin: 0 auto;         /* ortala */
      padding: 40px;
      box-sizing: border-box;
    }
    .center-text { text-align: center; margin: 0; line-height: 1.1; }
    .download-button { display: none; margin-top: 20px; }
    .ders-item { border: 1px solid #ccc; padding: 10px; margin-bottom: 20px; background-color: #fafafa; }

    .logo-image {
      display: block;
      margin: 0 auto 20px auto;
      max-width: 80px;
      height: auto;
    }
    .tarih-sag { text-align: right; margin: 0; font-size: 16px; }
    .alt-kisim {
      display: flex; justify-content: space-between; gap: 20px; margin-top: 30px;
    }
    .sol-metni { flex: 1; max-width: 50%; font-size: 16px; line-height: 1.4; }
    .sag-tablo { flex: 1; max-width: 50%; }
    .sag-tablo td { border: 1px solid black; padding: 10px; height: 100px; }

    @media (max-width: 768px) {
      body { padding: 10px; }
      .container { padding: 15px; max-width: 100%; box-shadow: none; }
      input, select, textarea, button { font-size: 14px; width: 100%; }
      table, th, td { font-size: 12px; word-break: break-word; }
      .alt-kisim { flex-direction: column; }
      .sag-tablo, .sol-metni { max-width: 100%; }
      .logo-image { max-width: 60px; }
      h2 { font-size: 18px; }
    }
#dersTablosu {
  margin-top: 5px !important; /* tabloyu baÅŸlÄ±ÄŸa yaklaÅŸtÄ±r */
}

  </style>
</head>
<body>
  <div class="container">
    <h2>Ã‡akÄ±ÅŸan Dersler Ä°Ã§in Mazeret SÄ±navÄ± Talep DilekÃ§esi OluÅŸturma</h2>

    <form id="dilekceForm">
      <label>AdÄ±nÄ±z:</label><input type="text" id="ad" required />
      <label>SoyadÄ±nÄ±z:</label><input type="text" id="soyad" required />
      <label>Ã–ÄŸrenci NumarasÄ±:</label><input type="text" id="numara" required />
      <label>YTÃœ E-posta KullanÄ±cÄ± AdÄ±nÄ±z:</label>
      <div style="display:flex;align-items:center;">
        <input type="text" id="emailUser" required pattern="^[^@]+$" placeholder="kullaniciadi" style="flex:1;" />
        <span style="margin-left:5px;">@std.yildiz.edu.tr</span>
      </div>
      <label>Cep Telefonu:</label><input type="text" id="telefon" required />
      <label>AÃ§Ä±klama yazÄ±nÄ±z:</label><textarea id="mazeret" rows="3" required></textarea>
      <label>BÃ¶lÃ¼mÃ¼nÃ¼zÃ¼ SeÃ§iniz:</label>
      <select id="bolumSelect" required>
        <option value="MATEMATÄ°K BÃ–LÃœM BAÅžKANLIÄžINA">MATEMATÄ°K</option>
        <option value="FÄ°ZÄ°K BÃ–LÃœM BAÅžKANLIÄžINA">FÄ°ZÄ°K</option>
        <option value="KÄ°MYA BÃ–LÃœM BAÅžKANLIÄžINA">KÄ°MYA</option>
        <option value="Ä°STATÄ°STÄ°K BÃ–LÃœM BAÅžKANLIÄžINA">Ä°STATÄ°STÄ°K</option>
        <option value="MOLEKÃœLER BÄ°YOLOJÄ° VE GENETÄ°K BÃ–LÃœM BAÅžKANLIÄžINA">MOLEKÃœLER BÄ°YOLOJÄ° VE GENETÄ°K</option>
        <option value="TÃœRK DÄ°LÄ° VE EDEBÄ°YATI BÃ–LÃœM BAÅžKANLIÄžINA">TÃœRK DÄ°LÄ° VE EDEBÄ°YATI</option>
        <option value="BATI DÄ°LLERÄ° VE EDEBÄ°YATLARI BÃ–LÃœM BAÅžKANLIÄžINA">BATI DÄ°LLERÄ° VE EDEBÄ°YATLARI</option>
      </select>

      <h3>Ã‡akÄ±ÅŸma Nedeniyle SÄ±navÄ±na GirdiÄŸim ve GiremediÄŸim Dersler</h3>
      <div id="dersListesi"></div>
      <button type="button" onclick="dersEkle()">âž• Ders Ekle</button>
      <br><br>
      <button type="submit">DilekÃ§eyi OluÅŸtur</button>
    </form>

    <div class="letter-section" id="dilekceOutput">
      <img src="https://ytumat.github.io/mazeret_sinav_talebi_dilekcesi/logo.png" alt="Logo" class="logo-image" crossorigin="anonymous" />
      <p class="tarih-sag" id="ustTarihYazisi"></p><br>
      <p class="center-text" style="font-weight:bold;">FEN-EDEBÄ°YAT FAKÃœLTESÄ°</p>
      <p id="bolumYazisi" class="center-text" style="font-weight:bold;"></p>
      <p class="center-text" style="font-style:italic;margin-bottom:1cm;">(Ã‡akÄ±ÅŸan Dersler Ä°Ã§in Mazeret SÄ±nav Talep Formu)</p>

      <p>BÃ¶lÃ¼mÃ¼nÃ¼z <strong><span id="numaraYazisi"></span></strong> numaralÄ± Ã¶ÄŸrencisiyim. 
      SÄ±navÄ±na Ã§akÄ±ÅŸma nedeniyle giremediÄŸim, aÅŸaÄŸÄ±da yazÄ±lÄ± derslerim iÃ§in mazeret sÄ±nav hakkÄ± talep ediyorum.<br><br>
      <span id="mazeretMetni"></span></p>

      <p id="adSoyadYazisi" style="text-align:right;margin-top:40px;"></p>
      <p id="epostaAltMetin" style="text-align:center;margin-top:40px;color:red;font-style:italic;"></p>
      <p id="telefonYazisi" style="text-align:left;margin-top:10px;"></p>
      <p id="emailYazisi" style="text-align:left;margin-top:2px;"></p><br>

      <table id="cakisanTablo">
        <thead><tr><th colspan="2">Ã‡akÄ±ÅŸan Dersleri AÅŸaÄŸÄ±ya KarÅŸÄ±lÄ±klÄ± Olarak YazÄ±nÄ±z</th></tr></thead>
        <tbody></tbody>
      </table>

     <p style="text-align:center;margin-top:40px;margin-bottom:0;padding:0;line-height:1;">
      <strong>MAZERET SINAVI TALEP EDÄ°LEN DERSLER</strong>
      </p>

      <table id="dersTablosu">
        <thead><tr><th>DERSÄ°N KODU</th><th>DERSÄ°N ADI</th><th>SINAV TARÄ°HÄ°</th><th>DERSÄ° VEREN Ã–ÄžRETÄ°M ÃœYESÄ°NÄ°N ADI</th></tr></thead>
        <tbody></tbody>
      </table>

      <div class="alt-kisim">
        <div class="sol-metni"><p><strong>Ek:</strong> 2 (Ä°ki) BÃ¶lÃ¼me ait sÄ±nav programÄ±.</p></div>
        <div class="sag-tablo"><table><tr><td id="bolumBaskani">BÃ¶lÃ¼m BaÅŸkanÄ±</td></tr></table></div>
      </div>

      <div class="download-button" id="downloadBtnDiv">
        <button id="downloadBtn">ðŸ“¥ PDF Olarak Ä°ndir</button>
      </div>
    </div>
  </div>

  <!-- jsPDF + html2canvas -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    function formatDersAdi(dersAdi){
      if(!dersAdi)return "";
      const trLower = s=>s.replace(/Ä°/g,"i").replace(/I/g,"Ä±").replace(/Åž/g,"ÅŸ").replace(/Äž/g,"ÄŸ").replace(/Ãœ/g,"Ã¼").replace(/Ã–/g,"Ã¶").replace(/Ã‡/g,"Ã§").toLowerCase();
      return dersAdi.split(" ").map(w=>w.charAt(0).toLocaleUpperCase("tr-TR")+trLower(w.slice(1))).join(" ");
    }
    function formatDersKodu(kod){ if(!kod)return ""; return kod.slice(0,3).toUpperCase()+kod.slice(3).toLowerCase(); }
    function dersEkle(){
      const c=document.getElementById("dersListesi");
      const d=document.createElement("div");
      d.className="ders-item";
      d.innerHTML=`
        <label>Ã‡akÄ±ÅŸan Derslerden SÄ±navÄ±na <strong>GirdiÄŸim</strong> Dersin Kodu-AdÄ±:</label>
        <input type="text" name="ders1kod" required />
        <label><strong>Mazeret SÄ±navÄ±</strong> Talep EttiÄŸim Dersin Kodu:</label>
        <input type="text" name="ders2kod" required />
        <label><strong>Mazeret SÄ±navÄ±</strong> Talep EttiÄŸim Dersin AdÄ±:</label>
        <input type="text" name="ders2ad" required />
        <label><strong>Mazeret SÄ±navÄ±</strong> Talep EttiÄŸim Dersin Ã–ÄŸretim Ãœyesi:</label>
        <input type="text" name="ders2hoca" required />
        <label>Ã‡akÄ±ÅŸma Nedeniyle SÄ±navÄ±na GiremediÄŸim Dersin SÄ±nav Tarihi:</label>
        <input type="text" name="sÄ±navtarih" required placeholder="gg.aa.yyyy" />`;
      c.appendChild(d);
    }
    window.onload=()=>dersEkle();

    document.getElementById("dilekceForm").addEventListener("submit",e=>{
      e.preventDefault();
      const ad=document.getElementById("ad").value.trim();
      const soyad=document.getElementById("soyad").value.trim();
      const numara=document.getElementById("numara").value.trim();
      const tel=document.getElementById("telefon").value.trim();
      const maz=document.getElementById("mazeret").value.trim();
      const bolum=document.getElementById("bolumSelect").value;
      const emailUser=document.getElementById("emailUser").value.trim();
      const email=`${emailUser}@std.yildiz.edu.tr`;
      const today=new Date().toLocaleDateString("tr-TR");
      window.adSoyad=`${ad}_${soyad}`.replace(/\s+/g,"_");

      document.getElementById("ustTarihYazisi").innerText=`Tarih: ${today}`;
      document.getElementById("bolumYazisi").innerText=bolum;
      document.getElementById("numaraYazisi").innerText=numara;
      document.getElementById("mazeretMetni").innerText=`AÃ§Ä±klama: ${maz}`;
      document.getElementById("adSoyadYazisi").innerHTML=`<strong>AdÄ±-SoyadÄ±:</strong> ${ad} ${soyad}`;
      document.getElementById("telefonYazisi").innerHTML=`Cep Tel: ${tel}`;
      document.getElementById("emailYazisi").innerHTML=`E-posta: ${email}`;
      document.getElementById("epostaAltMetin").innerText=`Bu belge ${email} adresinden bÃ¶lÃ¼me iletilmiÅŸtir.`;

      const baskanlar={
        "MATEMATÄ°K BÃ–LÃœM BAÅžKANLIÄžINA":"Matematik BÃ¶lÃ¼m BaÅŸkanÄ±",
        "FÄ°ZÄ°K BÃ–LÃœM BAÅžKANLIÄžINA":"Fizik BÃ¶lÃ¼m BaÅŸkanÄ±",
        "KÄ°MYA BÃ–LÃœM BAÅžKANLIÄžINA":"Kimya BÃ¶lÃ¼m BaÅŸkanÄ±",
        "Ä°STATÄ°STÄ°K BÃ–LÃœM BAÅžKANLIÄžINA":"Ä°statistik BÃ¶lÃ¼m BaÅŸkanÄ±",
        "MOLEKÃœLER BÄ°YOLOJÄ° VE GENETÄ°K BÃ–LÃœM BAÅžKANLIÄžINA":"MolekÃ¼ler Biyoloji ve Genetik BÃ¶lÃ¼m BaÅŸkanÄ±",
        "TÃœRK DÄ°LÄ° VE EDEBÄ°YATI BÃ–LÃœM BAÅžKANLIÄžINA":"TÃ¼rk Dili ve EdebiyatÄ± BÃ¶lÃ¼m BaÅŸkanÄ±",
        "BATI DÄ°LLERÄ° VE EDEBÄ°YATLARI BÃ–LÃœM BAÅžKANLIÄžINA":"BatÄ± Dilleri ve EdebiyatlarÄ± BÃ¶lÃ¼m BaÅŸkanÄ±"
      };
      document.getElementById("bolumBaskani").innerText=baskanlar[bolum]||"BÃ¶lÃ¼m BaÅŸkanÄ±";

      const dersler=document.querySelectorAll("#dersListesi .ders-item");
      const tbody1=document.querySelector("#dersTablosu tbody");
      const tbody2=document.querySelector("#cakisanTablo tbody");
      tbody1.innerHTML=""; tbody2.innerHTML="";
      dersler.forEach(d=>{
        const d1=formatDersKodu(d.querySelector("[name='ders1kod']").value);
        const kod=formatDersKodu(d.querySelector("[name='ders2kod']").value);
        const ad2=formatDersAdi(d.querySelector("[name='ders2ad']").value);
        const hoca=d.querySelector("[name='ders2hoca']").value;
        const tarih=d.querySelector("[name='sÄ±navtarih']").value;
        tbody1.innerHTML+=`<tr><td>${kod}</td><td>${ad2}</td><td>${tarih}</td><td>${hoca}</td></tr>`;
        tbody2.innerHTML+=`<tr><td>${d1}</td><td>${kod} ${ad2}</td></tr>`;
      });

      document.getElementById("dilekceOutput").style.display="block";
      document.getElementById("downloadBtnDiv").style.display="block";
    });

    document.getElementById("downloadBtn").addEventListener("click",()=>{
      const img=document.querySelector(".logo-image");
      const btn=document.getElementById("downloadBtnDiv");
      btn.style.visibility="hidden";
      const startPdf=()=>{
        html2canvas(document.getElementById("dilekceOutput"),{scale:3,useCORS:true}).then(canvas=>{
          const imgData=canvas.toDataURL("image/jpeg",0.9);
          const pdf=new window.jspdf.jsPDF({unit:"mm",format:"a4",orientation:"portrait"});
          const pdfW=pdf.internal.pageSize.getWidth();
          const pdfH=pdf.internal.pageSize.getHeight();
          const imgW=pdfW;
          const imgH=(canvas.height*imgW)/canvas.width;
          let pos=0, heightLeft=imgH, tolerance=10;
          pdf.addImage(imgData,"JPEG",0,pos,imgW,imgH);
          heightLeft-=pdfH;
          while(heightLeft>tolerance){
            pos=heightLeft-imgH;
            pdf.addPage();
            pdf.addImage(imgData,"JPEG",0,pos,imgW,imgH);
            heightLeft-=pdfH;
          }
          const pageCount=pdf.internal.getNumberOfPages();
          pdf.setFont("helvetica","italic"); pdf.setFontSize(8); pdf.setTextColor(150);
          const footer="(Form No: FR-0606; Revizyon Tarihi:14.01.2014; Revizyon No:00)";
          for(let i=1;i<=pageCount;i++){ pdf.setPage(i); pdf.text(footer,10,pdfH-7); }
                   pdf.save(`${window.adSoyad || "dilekce"}.pdf`);
          btn.style.visibility = "visible";
        });
      };

      if (img.complete) startPdf();
      else img.onload = startPdf;
    });
  </script>
</body>
</html>



