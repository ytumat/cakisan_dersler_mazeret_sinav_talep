<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>DilekÃ§e OluÅŸtur</title>
  <style>
    body {
      font-family: Calibri, "Times New Roman", serif;
      background-color: #f4f4f4;
      padding: 20px;
    }
    .container {
      max-width: 900px;
      margin: auto;
      background: white;
      padding: 30px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    input, select, textarea {
      width: 100%;
      padding: 8px;
      margin-top: 6px;
      margin-bottom: 16px;
      font-size: 16px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      margin-top: 10px;
      margin-right: 10px;
      cursor: pointer;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 30px;
    }
 table, th, td {
  border: 1px solid black;
  padding: 10px;
}

th {
  text-align: center; /* baÅŸlÄ±klar ortalÄ± kalabilir istersen */
}

td {
  text-align: center; /* iÃ§erikler sola yaslÄ± olur */
}

    .letter-section {
      display: none;
      margin-top: 40px;
      padding: 40px;
      background: white;
      border: none;
    }
    .center-text {
      text-align: center;
      margin: 0;
      line-height: 1.1;
    }
    .left-text {
      text-align: justify;
      margin-top: 20px;
      white-space: pre-line;
    }
    .download-button {
      display: none;
      margin-top: 20px;
    }
    .ders-item {
      border: 1px solid #ccc;
      padding: 10px;
      margin-bottom: 20px;
      background-color: #fafafa;
    }
    @media print {
      body * {
        visibility: hidden;
      }
      .letter-section, .letter-section * {
        visibility: visible;
      }
      .letter-section {
        position: absolute;
        top: 0;
        left: 0;
        width: 210mm;
        height: 297mm;
        background: white !important;
        padding: 40px;
        margin: 0;
        box-shadow: none !important;
        border: none !important;
      }
      .download-button {
        display: none !important;
      }
    }
    .logo-image {
      display: block;
      margin-left: auto;
      margin-right: auto;
      margin-bottom: 20px;
      max-width: 80px;
      height: auto;
    }
    .tarih-sag {
      text-align: right;
      margin: 0;
      font-size: 16px;
    }
    #tarihYeri,
    #imzaAlani {
      display: none;
    }
    .alt-kisim {
      display: flex;
      justify-content: space-between;
      gap: 20px; /* Ä°ki kolon arasÄ± boÅŸluk */
      margin-top: 30px;
    }
    .sol-metni {
      flex: 1;
      max-width: 50%;
      font-size: 16px;
      line-height: 1.4;
    }
    .sag-tablo {
      flex: 1;
      max-width: 50%;
    }
    .sag-tablo table {
      width: 100%;
      border-collapse: collapse;
    }
    .sag-tablo td {
      border: 1px solid black;
      padding: 10px;
      height: 100px;
    }
 #dersTablosu {
  margin-top: 5px !important;
}
@media (max-width: 768px) {
  body {
    padding: 10px;
  }

  .container {
    padding: 15px;
    max-width: 100%;
    box-shadow: none;
  }

  input, select, textarea, button {
    font-size: 14px;
    width: 100%;
  }

  table, th, td {
    font-size: 12px;
    word-break: break-word;
  }

  table {
    display: block;
    overflow-x: auto;
    white-space: nowrap;
  }

  .alt-kisim {
    flex-direction: column;
  }

  .sag-tablo, .sol-metni {
    max-width: 100%;
  }

  .logo-image {
    max-width: 60px;
  }

  h2 {
    font-size: 18px;
  }

  .center-text {
    font-size: 14px;
  }
}

  </style>
</head>
<body>
  <div class="container">
    <h2>Ã‡akÄ±ÅŸan Dersler Ä°Ã§in Mazeret SÄ±navÄ± Talep DilekÃ§esi OluÅŸturma</h2>
    <form id="dilekceForm">
      <label>AdÄ±nÄ±z:</label>
      <input type="text" id="ad" required />
      <label>SoyadÄ±nÄ±z:</label>
      <input type="text" id="soyad" required />
      <label>Ã–ÄŸrenci NumarasÄ±:</label>
      <input type="text" id="numara" required />
      
      <label>YTÃœ E-posta KullanÄ±cÄ± AdÄ±nÄ±z:</label>
      <div style="display: flex; align-items: center;">
        <input type="text" id="emailUser" required pattern="^[^@]+$" placeholder="kullaniciadi" style="flex: 1;" />
        <span style="margin-left: 5px;">@std.yildiz.edu.tr</span>
      </div>

      <label>Cep Telefonu:</label>
      <input type="text" id="telefon" required />
      <label>AÃ§Ä±klama yazÄ±nÄ±z:</label>
      <textarea id="mazeret" rows="3" required></textarea>
      <label>BÃ¶lÃ¼mÃ¼nÃ¼zÃ¼ SeÃ§iniz:</label>
      <select id="bolumSelect" required>
        <option value="MATEMATÄ°K BÃ–LÃœM BAÅžKANLIÄžINA">MATEMATÄ°K</option>
        <option value="FÄ°ZÄ°K BÃ–LÃœM BAÅžKANLIÄžINA">FÄ°ZÄ°K</option>
        <option value="KÄ°MYA BÃ–LÃœM BAÅžKANLIÄžINA">KÄ°MYA</option>
        <option value="Ä°STATÄ°STÄ°K BÃ–LÃœM BAÅžKANLIÄžINA">Ä°STATÄ°STÄ°K</option>
        <option value="MOLEKÃœLER BÄ°YOLOJÄ° VE GENETÄ°K BÃ–LÃœM BAÅžKANLIÄžINA">MOLEKÃœLER BÄ°YOLOJÄ° VE GENETÄ°K</option>
        <option value="TÃœRK DÄ°LÄ° VE EDEBÄ°YATI BÃ–LÃœM BAÅžKANLIÄžINA">TÃœRK DÄ°LÄ° VE EDEBÄ°YATI</option>
        <option value="BATI DÄ°LLERÄ° VE EDEBÄ°YATLARI BÃ–LÃœM BAÅžKANLIÄžINA">BATI DÄ°LLERÄ° VE EDEBÄ°YATLARI</option>
      </select>

      <h3>Ã‡akÄ±ÅŸma Nedeniyle SÄ±navÄ±na GirdiÄŸim ve GiremediÄŸim Dersler</h3>
      <div id="dersListesi"></div>
      <button type="button" onclick="dersEkle()">âž• Ders Ekle</button>

    


      <br><br>
      <button type="submit">DilekÃ§eyi OluÅŸtur</button>
    </form>

    <div class="letter-section" id="dilekceOutput">
      <img src="https://ytumat.github.io/mazeret_sinav_talebi_dilekcesi/logo.png" alt="Ãœniversite Logosu" class="logo-image" crossorigin="anonymous" />
      <p class="tarih-sag" id="ustTarihYazisi"></p><br>
      <p class="center-text" style="font-weight: bold;">FEN-EDEBÄ°YAT FAKÃœLTESÄ°</p>
      <p id="bolumYazisi" class="center-text" style="font-weight: bold;"></p>
      <p class="center-text" style="font-style: italic;margin-bottom: 1cm;">(Ã‡akÄ±ÅŸan Dersler Ä°Ã§in Mazeret SÄ±nav Talep Formu)</p>

      <p> BÃ¶lÃ¼mÃ¼nÃ¼z <strong><span id="numaraYazisi"></span></strong> numaralÄ± Ã¶ÄŸrencisiyim. SÄ±navÄ±na Ã§akÄ±ÅŸma nedeniyle giremediÄŸim, aÅŸaÄŸÄ±daki tabloda yazÄ±lÄ± derslerim iÃ§in mazeret sÄ±nav hakkÄ± tanÄ±nmasÄ±nÄ± arz ederim.<br><br>
      <span id="mazeretMetni" style="text-align: left;"></span></p>

      <p id="adSoyadYazisi" style="text-align: right; margin-top: 40px;"></p>
      <p id="telefonYazisi" style="text-align: left; margin-top: 10px;"></p>
      <p id="emailYazisi" style="text-align: left; margin-top: 2px;"></p><br>

      <table id="cakisanTablo">
        <thead>
          <tr>
            <th colspan="2">Ã‡akÄ±ÅŸan dersleri aÅŸaÄŸÄ±ya karÅŸÄ±lÄ±klÄ± olarak yazÄ±nÄ±z</th>
          </tr>          
        </thead>
        <tbody></tbody>
      </table>

      <br><br><br>
<!-- <div class="left-text" id="ogrenciBilgileri"></div> -->

<!-- <p style="margin: 0 0 0 0; text-align: center;"><strong>MAZERET SINAVI TALEP EDÄ°LEN DERSLER</strong></p> -->


<p style="text-align: center; margin: 0 0 5px 0;"><strong>MAZERET SINAVI TALEP EDÄ°LEN DERSLER</strong></p>

        <table id="dersTablosu">
        <thead>
          <tr>
            <th>DERSÄ°N KODU</th>
            <th>DERSÄ°N ADI</th>
            <th>SINAV TARÄ°HÄ°</th>
            <th>DERSÄ° VEREN Ã–ÄžRETÄ°M ÃœYESÄ°NÄ°N ADI</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div class="alt-kisim">
        <div class="sol-metni">
          <p><br><strong>Ek:</strong> 2 (Ä°ki) BÃ¶lÃ¼me ait sÄ±nav programÄ±.</p>
        </div>
        <div class="sag-tablo">
          <table>
            <tr>
              <td style="border: 1px solid black; padding: 10px; height: 100px;"> <br>BÃ¶lÃ¼m BaÅŸkanÄ±</td>
            </tr>
          </table>
        </div>
      </div>

      <p style="text-align: right;" id="tarihYeri"></p>
      <p style="text-align: right;" id="imzaAlani">Ä°mza: _________</p>
      <p id="epostaAltMetin" style="text-align: center; margin-top: 40px; font-style: italic;"></p>

      <div class="download-button" id="downloadBtnDiv">
        <button id="downloadBtn">ðŸ“¥ PDF Olarak Ä°ndir</button>
      </div>
    </div>
  </div>

  <!-- jsPDF ve html2canvas -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    function formatDersAdi(dersAdi) {
      if (!dersAdi) return "";
      const turkishToLower = (str) =>
        str.replace(/Ä°/g, "i").replace(/I/g, "Ä±")
           .replace(/Åž/g, "ÅŸ").replace(/Äž/g, "ÄŸ")
           .replace(/Ãœ/g, "Ã¼").replace(/Ã–/g, "Ã¶")
           .replace(/Ã‡/g, "Ã§").toLowerCase();
      const turkishCapitalize = (str) =>
        str.charAt(0).toLocaleUpperCase("tr-TR") + turkishToLower(str.slice(1));
      return dersAdi
        .split(" ")
        .map(kelime => turkishCapitalize(kelime))
        .join(" ");
    }

    function formatDersKodu(kod) {
      if (!kod) return "";
      const firstThree = kod.slice(0, 3).toUpperCase();
      const rest = kod.slice(3).toLowerCase();
      return firstThree + rest;
    }

    function dersEkle() {
      const container = document.getElementById("dersListesi");
      const div = document.createElement("div");
      div.className = "ders-item ders-ekle";
      div.innerHTML = `
        <label>Ã‡akÄ±ÅŸan Derslerden SÄ±navÄ±na <strong>GirdiÄŸim</strong> Dersin Kodu-AdÄ±:</label><input type="text" name="ders1kod" required />
        <label><strong>Mazeret SÄ±navÄ±</strong> Talep EttiÄŸim Dersin Kodu:</label><input type="text" name="ders2kod" required />
        <label><strong>Mazeret SÄ±navÄ±</strong> Talep EttiÄŸim Dersin AdÄ±:</label><input type="text" name="ders2ad" required />
        <label> <strong>Mazeret SÄ±navÄ±</strong> Talep EttiÄŸim Dersin Ã–ÄŸretim Ãœyesi:</label><input type="text" name="ders2hoca" required />
        <label>Ã‡akÄ±ÅŸma Nedeniyle SÄ±navÄ±na GiremediÄŸim Dersin SÄ±nav Tarihi:</label><input type="text" name="sÄ±navtarih" required placeholder="gg.aa.yyyy" />
      `;
      container.appendChild(div);
    }

    
    window.onload = () => {
      dersEkle();
      };

    document.getElementById("dilekceForm").addEventListener("submit", function(e) {
      e.preventDefault();

      const ad = document.getElementById("ad").value.trim();
      const soyad = document.getElementById("soyad").value.trim();
      const numara = document.getElementById("numara").value.trim();
      const telefon = document.getElementById("telefon").value.trim();
      const mazeret = document.getElementById("mazeret").value.trim();
      const bolum = document.getElementById("bolumSelect").value;
      const emailUser = document.getElementById("emailUser").value.trim();
      const email = `${emailUser}@std.yildiz.edu.tr`;

      const today = new Date();
      const formattedDate = today.toLocaleDateString("tr-TR");
      window.adSoyad = `${ad}_${soyad}`.replace(/\s+/g, "_");

      document.getElementById("ustTarihYazisi").innerText = `Tarih: ${formattedDate}`;
      document.getElementById("tarihYeri").innerText = `Tarih: ${formattedDate}`;
      document.getElementById("bolumYazisi").innerText = bolum;
      document.getElementById("numaraYazisi").innerText = numara;
      document.getElementById("mazeretMetni").innerHTML = `AÃ§Ä±klama: ${mazeret}`;
      document.getElementById("adSoyadYazisi").innerHTML = `<strong>AdÄ±â€‘SoyadÄ±:</strong> ${ad} ${soyad}`;
      document.getElementById("telefonYazisi").innerHTML = `<strong>Cep Tel:</strong> ${telefon}`;
      document.getElementById("emailYazisi").innerHTML = `<strong>E-posta:</strong> ${email}`;
      document.getElementById("epostaAltMetin").innerText = `Bu belge ${email} adresinden bÃ¶lÃ¼me iletilmiÅŸtir.`;

      // Ders tablosu
const dersler = document.querySelectorAll("#dersListesi .ders-ekle");
 const dersTbody = document.querySelector("#dersTablosu tbody");
 dersTbody.innerHTML = "";

const cakisanTbody = document.querySelector("#cakisanTablo tbody");
cakisanTbody.innerHTML = "";

dersler.forEach(ders => {
       
        const ders1 = formatDersKodu(ders.querySelector("input[name='ders1kod']").value);
        const kod = formatDersKodu(ders.querySelector("input[name='ders2kod']").value);
        const adders = formatDersAdi(ders.querySelector("input[name='ders2ad']").value);
        const hoca = ders.querySelector("input[name='ders2hoca']").value;
        const tarih = ders.querySelector("input[name='sÄ±navtarih']").value;

     
          
        const row1 = document.createElement("tr");
        row1.innerHTML = `<td>${kod}</td><td>${adders}</td><td>${tarih}</td><td>${hoca}</td>`;
        dersTbody.appendChild(row1);
     
// Ã‡akÄ±ÅŸan Ders tablosu
      
      
        const row2 = document.createElement("tr");
        row2.innerHTML = `<td>${ders1}</td><td>${kod} ${adders}</td>`;
        cakisanTbody.appendChild(row2);
      });




      
      document.getElementById("dilekceOutput").style.display = "block";
      document.getElementById("downloadBtnDiv").style.display = "block";
    });

    document.getElementById("downloadBtn").addEventListener("click", function () {
      const img = document.querySelector(".logo-image");
      const downloadBtnDiv = document.getElementById("downloadBtnDiv");
      downloadBtnDiv.style.visibility = "hidden";

      const startPdf = () => {
        html2canvas(document.getElementById("dilekceOutput"), { scale: 3, useCORS: true }).then(canvas => {
          const imgData = canvas.toDataURL("image/jpeg", 0.8); // 0.8 kalite, isteÄŸe gÃ¶re dÃ¼ÅŸÃ¼rÃ¼lebilir
          const pdf = new window.jspdf.jsPDF("p", "mm", "a4");
          const pdfWidth = 210;
          const pdfHeight = 297;
          const pxPerMm = canvas.width / pdfWidth;
          const imgHeight = canvas.height / pxPerMm;

          let renderHeight = imgHeight;
          let renderWidth = pdfWidth;

          if (imgHeight > pdfHeight) {
            const scale = pdfHeight / imgHeight;
            renderHeight = pdfHeight;
            renderWidth = pdfWidth * scale;
          }

          pdf.addImage(imgData, "PNG", 0, 0, renderWidth, renderHeight);
          pdf.setFont("helvetica", "italic");
          pdf.setFontSize(8);
          pdf.setTextColor(150);
          pdf.text("(Form No: FR-0606; Revizyon Tarihi:14.01.2014; Revizyon No:00)", 10, 290);

          pdf.save(`${window.adSoyad || "dilekce"}.pdf`);
          downloadBtnDiv.style.visibility = "visible";
        });
      };

      if (!img.complete) {
        img.onload = startPdf;
        img.onerror = () => {
          alert("Logo yÃ¼klenemedi!");
          startPdf();
        };
      } else {
        startPdf();
      }
    });
  </script>
</body>
</html>


